<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chicago</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app" class="primary-color">
      <h1>Chicago</h1>
      <section id="phaseAddPlayers" v-if="notStarted" class="phaseStart">
        <h2>Add players</h2>
        <input
          v-model.trim="playerName"
          placeholder="Name"
          @keyup.enter="addPlayer"
          @input="playerName = $event.target.value"
        />
        <button v-if="playerName.length > 0" @click="addPlayer">Ok</button>
        <p class="output">{{output}}</p>
        <div class="playerSection">
          <p v-for="player in players">{{player.name}}</p>
        </div>
        <div class="btnWrapper">
          <button v-if="players.length > 1" @click="started" class="startBtn">
            Start
          </button>
        </div>
      </section>
      <section id="phaseRounds" v-if="!notStarted">
        <section v-if="isRoundPhase" class="phaseRounds">
          <h2>{{phase[0].name}} {{phase[0].round}}</h2>
          <div class="playerSection">
            <p v-for="player in players">{{player.name}}: {{player.score}}</p>
          </div>
          <p>
            Add score to:
            <span class="currentPlayer">{{players[currentPlayer].name}}</span>
            <span
              ><button @click="togglePlayer" class="changeBtn">
                Change
              </button></span
            >
          </p>
          <div class="grid-container">
            <button @click="addScore(0)">{{values[0].name}}</button>
            <button @click="addScore(1)">{{values[1].name}}</button>
            <button @click="addScore(2)">{{values[2].name}}</button>
            <button @click="addScore(3)">{{values[3].name}}</button>
            <button @click="addScore(4)">{{values[4].name}}</button>
            <button @click="addScore(5)">{{values[5].name}}</button>
            <button @click="addScore(6)">{{values[6].name}}</button>
            <button @click="addScore(7)">{{values[7].name}}</button>
          </div>
        </section>
      </section>
      <section id="phaseTricks" v-if="!notStarted" class="phaseTrick">
        <section v-if="isTrickPhase">
          <h2>{{phase[1].name}}</h2>
          <div class="playerSection">
            <p v-for="player in players">{{player.name}}: {{player.score}}</p>
          </div>
          <p>
            Add score to:
            <span class="currentPlayer">{{players[currentPlayer].name}}</span>
            <span
              ><button @click="togglePlayer" class="changeBtn">
                Change
              </button></span
            >
          </p>
          <div class="btnWrapper">
            <button @click="addScore(8)">{{values[8].name}}</button>
          </div>
        </section>
      </section>
      <section v-if="isFinished">
        <h2>Game Over</h2>
        <p class="winningPhrase">
          The winner is
          <span class="currentPlayer">{{winner[0].name}}</span> with
          <span class="currentPlayer">{{winner[0].score}}</span> points!
        </p>
      </section>
    </div>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script>
      const { createApp } = Vue;
      createApp({
        data() {
          return {
            playerName: "",
            players: [],
            currentPlayer: "",
            notStarted: true,
            phase: [
              {
                name: "Round",
                round: 1,
              },
              {
                name: "Trick",
                round: 1,
              },
            ],
            values: [
              {
                name: "One pair",
                points: 1,
              },
              {
                name: "Two pair",
                points: 2,
              },
              {
                name: "Three of a kind",
                points: 3,
              },
              {
                name: "Straight",
                points: 4,
              },
              {
                name: "Flush",
                points: 5,
              },
              {
                name: "Full House",
                points: 6,
              },
              {
                name: "Four of a kind",
                points: 8,
                reset: false,
              },
              {
                name: "Straight Flush",
                points: 52,
              },
              {
                name: "Trick +5",
                points: 5,
              },
            ],
            isRoundPhase: true,
            isTrickPhase: false,
            isFinished: false,
            winner: [],
            output: "",
          };
        },
        methods: {
          addPlayer() {
            if (this.playerName === "") {
              this.output = "Name must be at least one letter!";
            } else {
              this.output = "";
              this.players.push({
                name: this.playerName,
                score: 0,
              });
              this.playerName = "";
            }
          },
          started() {
            this.notStarted = false;

            let randomNum = Math.floor(
              Math.random() * (this.players.length - 1)
            );
            this.currentPlayer = randomNum;
          },
          addScore(valueIndex) {
            if (valueIndex === 8) {
              this.players[this.currentPlayer].score +=
                this.values[valueIndex].points;
              this.isRoundPhase = true;
              this.isTrickPhase = false;
              this.phase[0].round++;
            } else if (this.phase[0].round === 2) {
              this.players[this.currentPlayer].score +=
                this.values[valueIndex].points;
              this.isRoundPhase = false;
              this.isTrickPhase = true;
            } else if (this.phase[0].round === 3) {
              this.players[this.currentPlayer].score +=
                this.values[valueIndex].points;
              this.isRoundPhase = false;
              this.isFinished = true;
              this.checkWinner();
            } else {
              this.players[this.currentPlayer].score +=
                this.values[valueIndex].points;
              this.phase[0].round++;
            }
          },
          togglePlayer() {
            if (this.currentPlayer === this.players.length - 1) {
              this.currentPlayer = 0;
            } else {
              this.currentPlayer++;
            }
          },
          checkWinner() {
            let highestPoint = 0;
            let winnerName = "";
            this.players.forEach((player) => {
              if (player.score > highestPoint) {
                highestPoint = player.score;
                winnerName = player.name;
              }
            });
            this.winner.push({
              name: winnerName,
              score: highestPoint,
            });
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
